# 📊 PixEngine 벤치마크

다양한 포맷, 품질 설정, 출력 크기에 걸친 PixEngine 이미지 최적화 성능에 대한 종합 분석입니다.

---

## 🎯 테스트 방법론

### 테스트 이미지
- **총 이미지 수**: 11개의 합성 테스트 이미지
- **이미지 유형**:
  - 단색 (3개) - 압축 최적 케이스
  - 그라데이션 (2개) - 밴딩 테스트
  - 텍스트 오버레이 (2개) - 샤프한 엣지 테스트
  - 노이즈 패턴 (1개) - 압축 최악 케이스
  - 체크무늬 (1개) - 고주파 디테일
  - UI 목업 (1개) - 실제 시나리오
  - 혼합 콘텐츠 (1개) - 그라데이션 + 텍스트

### 테스트 규격
- **원본 크기**: 1920x1080 픽셀
- **테스트 구성**:
  - 품질 수준: 50, 70, 85, 95
  - 포맷: WebP, AVIF, JPEG, PNG
  - 출력 크기: 200px, 500px, 800px, 1200px

### 총 수행 테스트
모든 조합에 걸쳐 **132개 테스트**

---

## 📈 전체 통계

| 항목 | 값 |
|------|-----|
| 수행된 총 테스트 수 | 132 |
| 테스트된 고유 이미지 수 | 11 |
| **평균 감소율** | **79.4%** |

---

## 🎨 포맷 비교

**품질 85, 너비 800px** 기준 성능 비교.

| 포맷 | 평균 감소율 | 최소 | 최대 | 평균 출력 크기 |
|------|-------------|------|------|----------------|
| **WebP** | **84.5%** | 58.3% | 94.1% | 20.5 KB |
| **AVIF** | **83.0%** | 51.2% | 97.4% | 47.2 KB |
| JPEG | 63.0% | -39.2% | 87.7% | 27.7 KB |
| PNG | 42.4% | -154.5% | 96.3% | 44.0 KB |

### 주요 발견사항

✅ **WebP**가 전체적으로 최고의 압축률 제공 (평균 84.5%)
✅ **AVIF**는 단색과 그라데이션에서 탁월함 (최대 97.4%)
⚠️ **JPEG**는 패턴에서 어려움을 겪지만 노이즈는 잘 처리
⚠️ **PNG**는 특정 콘텐츠(텍스트, 패턴)에서만 효율적

### ⚠️ 중요 참고사항

- PNG → JPEG 변환 시 파일 크기가 **증가**할 수 있음 (최대 -154%)
- JPEG → PNG 변환은 매우 비효율적
- 포맷 선택은 콘텐츠 유형과 일치해야 함

---

## ⚙️ 품질 파라미터 영향

**너비 800px**에서 다양한 품질 설정에 따른 WebP 압축.

| 품질 | 평균 감소율 | 평균 출력 크기 | Q85 대비 크기 |
|------|-------------|----------------|---------------|
| 50 | 88.8% | 12.2 KB | -40.5% |
| 70 | 87.7% | 15.0 KB | -26.6% |
| **85** | **84.5%** | **20.5 KB** | **0.0%** (기준) |
| 95 | 73.5% | 30.6 KB | +49.5% |

### 🎯 품질 최적 구간: 70-85

#### 왜 품질 70-85인가?

**품질 50 → 70**: 파일 크기 23% 증가하지만 품질이 크게 향상됨 ✅
**품질 70 → 85**: 파일 크기 37% 증가, 품질이 적당히 향상됨 ✅
**품질 85 → 95**: 파일 크기 49% 증가하지만 품질은 미세하게만 향상됨 ❌

#### 계산 예시

```
Q85 → Q95: 파일 크기 +49.5%인데 압축률은 11%만 감소 (비효율)
Q70 → Q85: 파일 크기 +36.7%인데 압축률은 3.2%만 감소 (효율적)
```

**권장사항**:
- **품질 70**: 대부분의 사용 사례에 최적 균형
- **품질 85**: 업계 표준, 안전한 선택
- **품질 95**: 최고 품질이 필요한 중요 자산에만 사용

---

## 📐 출력 크기 영향

다양한 출력 너비에서의 WebP 품질 85.

| 너비 | 평균 감소율 | 평균 출력 크기 | 평균 치수 |
|------|-------------|----------------|-----------|
| 200px | **96.1%** | 2.1 KB | 200x113 |
| 500px | 90.7% | 8.6 KB | 500x281 |
| 800px | 84.5% | 20.5 KB | 800x450 |
| 1200px | 74.7% | 48.5 KB | 1200x675 |

### 주요 인사이트

**썸네일(200px)이 가장 높은 압축률 달성**: 96.1% 감소!

작은 출력 크기의 이점:
- 인코딩할 픽셀 수가 적음
- 세밀한 디테일 손실 (의도적)
- 더 나은 압축 비율

---

## 🏆 이미지 유형별 최적 포맷

| 이미지 유형 | 최적 포맷 | 감소율 | 최악 포맷 | 감소율 |
|-------------|-----------|--------|-----------|--------|
| 단색 | AVIF | 97.4% | JPEG | 80.5% |
| 그라데이션 | AVIF | 82-85% | PNG | -154% |
| 텍스트 오버레이 | PNG | 85% | JPEG | 53-61% |
| UI 목업 | AVIF | 85.7% | JPEG | 68.6% |
| 혼합 콘텐츠 | AVIF | 93.2% | PNG | 63.2% |
| 체크무늬 | PNG | 95% | JPEG | -39.2% |
| 노이즈 패턴 | JPEG | 87.7% | AVIF | 64.2% |

### 포맷 선택 가이드라인

```typescript
// 콘텐츠 유형에 따른 권장 정책 로직

if (단색 || 그라데이션) {
  format = "avif";  // 부드러운 색상 전환에 최적
}

if (텍스트 || 샤프한엣지 || 패턴) {
  format = "png";   // 샤프한 엣지 보존
}

if (사진 || 자연이미지) {
  format = "webp";  // 최고의 범용 성능
}

if (고노이즈 || 그레인) {
  format = "jpeg";  // 현대 포맷보다 노이즈 처리가 우수
}
```

---

## 💡 핵심 인사이트

### 1. 최고의 범용 포맷
**WebP**가 모든 이미지 유형에서 평균 84.5% 감소율 달성.

### 2. 품질 최적 구간
**품질 70-85**가 파일 크기와 시각적 품질 간 최적 균형 제공.

- 품질 70: 87.7% 감소율 (공격적이지만 양호)
- 품질 85: 84.5% 감소율 (권장 표준)

### 3. 썸네일 최적화
**200px 썸네일이 96.1% 감소율 달성** - 작은 크기에 극적인 최적화.

### 4. 포맷별 성능
- **WebP**가 **11개 중 4개 이미지**에서 더 우수한 성능 (36%)
- **AVIF**가 **11개 중 7개 이미지**에서 더 우수한 성능 (64%)

**결론**: 모든 경우에 최적인 단일 포맷은 없음. 콘텐츠 인식 포맷 선택이 중요함.

---

## 📋 권장 정책

### 보수적 (높은 품질)
```typescript
policy: () => ({
  variants: [
    { width: 200, format: "webp", quality: 85 },
    { width: 800, format: "webp", quality: 90 },
    { width: 1200, format: "avif", quality: 90 },
  ],
});
```

### 균형 (권장)
```typescript
policy: () => ({
  variants: [
    { width: 200, format: "webp", quality: 70 },
    { width: 800, format: "webp", quality: 85 },
    { width: 1200, format: "avif", quality: 85 },
  ],
});
```

### 공격적 (최대 압축)
```typescript
policy: () => ({
  variants: [
    { width: 200, format: "webp", quality: 50 },
    { width: 500, format: "webp", quality: 70 },
    { width: 800, format: "avif", quality: 70 },
  ],
});
```

### 콘텐츠 인식 (고급)
```typescript
policy: (ctx) => {
  // 단색 또는 단순 그라데이션 감지
  if (ctx.bytes < 100000 && ctx.format === "png") {
    return {
      variants: [{ width: 800, format: "avif", quality: 85 }],
    };
  }

  // 사진
  if (ctx.format === "jpeg") {
    return {
      variants: [
        { width: 200, format: "webp", quality: 70 },
        { width: 800, format: "webp", quality: 85 },
      ],
    };
  }

  // 텍스트/UI (샤프함 보존)
  return {
    variants: [{ width: 800, format: "png", quality: 95 }],
  };
},
```

---

## ⚠️ 중요 제한사항

### 합성 테스트 이미지
이 벤치마크는 **프로그래밍 방식으로 생성된 테스트 이미지**를 사용하며, 실제 사진과는 결과가 다를 수 있습니다:
- 복잡한 사진 콘텐츠
- EXIF 데이터가 있는 이미지
- 투명도가 있는 이미지
- 매우 큰(>4000px) 이미지
- 매우 작은(<100px) 이미지

### 품질 평가
파일 크기 감소율을 보고하지만, **지각적 품질**은 항상 프로덕션 사용 전 수동으로 확인해야 합니다.

> **권장사항**: 프로덕션에 배포하기 전에 항상 실제 이미지의 대표 샘플에 대해 시각적 품질 검사를 수행하세요.

---

## 📚 관련 문서

- [품질 파라미터 가이드](./QUALITY-GUIDE_KR.md) _(예정)_
- [정책 예제](./POLICY-EXAMPLES_KR.md) _(예정)_
- [포맷 비교](./FORMAT-COMPARISON_KR.md) _(예정)_

---

## 🔬 테스트 재현

모든 벤치마크 스크립트가 저장소에 공개되어 있어 완전한 투명성과 재현성을 보장합니다.

```bash
# 저장소 클론
git clone https://github.com/pixengine/pixengine.git
cd pixengine/examples/benchmarks

# 의존성 설치
npm install

# 전체 벤치마크 스위트 실행
npm run all

# 또는 단계별로 실행:
npm run generate  # 테스트 이미지 생성
npm run bench     # 벤치마크 실행
npm run analyze   # 결과 분석
```

자세한 설명은 [examples/benchmarks/README.md](../../examples/benchmarks/README.md)를 참조하세요.

---

**최종 업데이트**: 2026-01-05
**PixEngine 버전**: 0.2.0
**테스트 환경**: Node.js, Sharp Engine, Local Storage
